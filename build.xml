<?xml version="1.0" encoding="UTF-8"?>
    <project name="PrimaveraSDK" basedir="." default="test">

    <property name="version" value="1.8"/>
    <property name="haltonfailure" value="no"/>

    <property name="out" value="out"/>

    <property name="production.src" value="src"/>
    <property name="production.lib" value="lib"/>
    <property name="production.classes" value="${out}/production/${ant.project.name}"/>

    <property name="test.src" value="test"/>
    <property name="test.lib" value="lib"/>
    <property name="test.classes" value="${out}/test/${ant.project.name}"/>

    <property name="reports.out" value="${out}/reports"/>
    <property name="junit.out" value="${reports.out}/junit"/>
    <property name="local.junit.out" value="${junit.out}/local"/>
    <property name="rmi.junit.out" value="${junit.out}/rmi"/>
    <property name="ws.junit.out" value="${junit.out}/ws"/>

    <path id="production.class.path">
        <pathelement location="${production.classes}"/>
        <fileset dir="${production.lib}">
            <include name="p6_local_api/*.jar"/>
            <include name="p6_rmi_api/*.jar"/>
            <include name="p6_ws_api/*.jar"/>
        </fileset>
    </path>

    <path id="test.class.path">
        <path refid="production.class.path"/>
        <pathelement location="${test.classes}"/>
        <fileset dir="${test.lib}">
            <include name="junit/*.jar"/>
        </fileset>
    </path>


    <available file="${out}" property="outputExists"/>

    <target name="clean" description="remove all generated artifacts" if="outputExists">
        <delete dir="${out}" includeEmptyDirs="true"/>
        <delete dir="${reports.out}" includeEmptyDirs="true"/>
    </target>

    <target name="create" description="create the output directories" >
        <mkdir dir="${production.classes}"/>
        <mkdir dir="${test.classes}"/>
        <mkdir dir="${reports.out}"/>
        <mkdir dir="${junit.out}"/>
        <mkdir dir="${local.junit.out}"/>
        <mkdir dir="${rmi.junit.out}"/>
        <mkdir dir="${ws.junit.out}"/>
    </target>

    <target name="compile" description="compile all .java source files" depends="create">
        <!-- Debug output
                <property name="production.class.path" refid="production.class.path"/>
                <echo message="${production.class.path}"/>
        -->
        <javac includeantruntime="false" srcdir="src" destdir="${out}/production/${ant.project.name}" debug="on" source="${version}">
            <classpath refid="production.class.path"/>
            <include name="**/*.java"/>
            <exclude name="**/*Test.java"/>
        </javac>
        <javac includeantruntime="false" srcdir="${test.src}" destdir="${out}/test/${ant.project.name}" debug="on" source="${version}">
            <classpath refid="test.class.path"/>
            <include name="**/*Test.java"/>
        </javac>
    </target>

    <target name="junit-local" description="run all junit tests" depends="compile">
        <!-- Debug output
                <property name="test.class.path" refid="test.class.path"/>
                <echo message="${test.class.path}"/>
        -->
        <junit printsummary="yes" haltonfailure="${haltonfailure}">
            <classpath refid="test.class.path"/>
            <formatter type="xml"/>
            <batchtest fork="yes" todir="${local.junit.out}">
                <fileset dir="${test.src}">
                    <include name="**/*Test.java"/>
                    <exclude name="**/*RmiTest.java"/>
                    <exclude name="**/*WsTest.java"/>
                </fileset>
            </batchtest>
        </junit>
        <junitreport todir="${local.junit.out}">
            <fileset dir="${local.junit.out}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report todir="${local.junit.out}" format="frames"/>
        </junitreport>
    </target>

    <target name="junit-rmi" description="run all junit tests" depends="compile">
        <!-- Debug output
                <property name="test.class.path" refid="test.class.path"/>
                <echo message="${test.class.path}"/>
        -->
        <junit printsummary="yes" haltonfailure="${haltonfailure}">
            <classpath refid="test.class.path"/>
            <formatter type="xml"/>
            <batchtest fork="yes" todir="${rmi.junit.out}">
                <fileset dir="${test.src}">
                    <include name="**/*Test.java"/>
                    <exclude name="**/*LocalTest.java"/>
                    <exclude name="**/*WsTest.java"/>
                </fileset>
            </batchtest>
        </junit>
        <junitreport todir="${rmi.junit.out}">
            <fileset dir="${rmi.junit.out}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report todir="${rmi.junit.out}" format="frames"/>
        </junitreport>
    </target>

    <target name="junit-ws" description="run all junit tests" depends="compile">
        <!-- Debug output
                <property name="test.class.path" refid="test.class.path"/>
                <echo message="${test.class.path}"/>
        -->
        <junit printsummary="yes" haltonfailure="${haltonfailure}">
            <classpath refid="test.class.path"/>
            <formatter type="xml"/>
            <batchtest fork="yes" todir="${ws.junit.out}">
                <fileset dir="${test.src}">
                    <include name="**/*Test.java"/>
                    <exclude name="**/*RmiTest.java"/>
                    <exclude name="**/*LocalTest.java"/>
                </fileset>
            </batchtest>
        </junit>
        <junitreport todir="${ws.junit.out}">
            <fileset dir="${ws.junit.out}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report todir="${ws.junit.out}" format="frames"/>
        </junitreport>
    </target>

    <target name="junit-test" description="run all junit tests" depends="compile, junit-rmi, junit-local, junit-ws" />


	<target name="test" depends="clean, create, junit-local" />
  <target name="test-all" depends="clean, create, junit-test" />


</project>
